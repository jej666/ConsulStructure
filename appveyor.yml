environment:
  SSL_CERT_FILE: C:\ca\cacert.pem
  COVERALLS_REPO_TOKEN:
    secure: sR+OO2wYopy1MdZX+asECm56PinUUuIHNQXcAfSmVlf6lw6y4I5jOiby5IqsuwyP
  GITHUB_TOKEN:
    secure: LWCRPexJEGMkW0f8ku8Q45CPnQDCi4sgyi/cFdOHizI9ToLlDYozXxI21bD9cDU4
  github_username: serialseb
  github_password:
    secure:
      1lXaOJ0GvCAOd0O9DDvVqw2eb7TvP2jve12u3hD2g4J7RVW2c2jC5XuRFyEuduUA
  coverity_token:
    secure: xZnMqxFHZN9mENgS6gGTtlz7hadzkcHVgp5HRGML4XY=

assembly_info:
  patch: false
  file: src\CommonInfo.cs
  assembly_version: $(AssemblyMajor).0.0.0
  assembly_file_version: '{version}'
  assembly_informational_version: '{version}'

nuget:
  project_feed: true
  disable_publish_on_pr: true

configuration: Debug

platform: Any CPU

cache:
  - packages -> **\packages.config

install:
  - set PATH=C:\Ruby23\bin;%PATH%
  - ps: mkdir c:\ca; iwr http://curl.haxx.se/ca/cacert.pem -outfile C:\ca\cacert.pem
  - set SSL_CERT_FILE=C:\ca\cacert.pem
  - ps: ./build/Set-Version.ps1

before_build:
  - pushd && cd src && nuget restore && popd

build:
  parallel: true
  verbosity: minimal
  publish_nuget: true
  publish_nuget_symbols: true
  include_nuget_references: true
  project: src/ConsulStructure.sln

build_script:
  - ps: echo (get-location)
  - ps: ./build/Build-Solution.ps1

after_build:
  - pushd
  - cd %APPVEYOR_BUILD_FOLDER%
  - ps: ./build/Pubish-Coverity.ps1
  - ps: ./build/Create-Package.ps1
artifacts:
 - path: src\openrasta\bin\$(configuration)\*.dll
   name: dlls
 - path: src\openrasta\bin\$(configuration)\*.pdb
   name: pdbs
 - path: '*.nupkg'
 - path: opencoverCoverage.xml
 - path: coverity.zip
   name: Coverity Build

test_script:
- ps: ./build/Test-Code.ps1
